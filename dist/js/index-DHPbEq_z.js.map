{"version":3,"file":"index-DHPbEq_z.js","sources":["../../src/pages/deposits/index.jsx"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { format } from 'date-fns';\nimport Box from '@mui/material/Box';\nimport Grid from '@mui/material/Grid';\nimport Typography from '@mui/material/Typography';\nimport Table from '@mui/material/Table';\nimport TableBody from '@mui/material/TableBody';\nimport TableCell from '@mui/material/TableCell';\nimport TableHead from '@mui/material/TableHead';\nimport TableRow from '@mui/material/TableRow';\nimport TextField from '@mui/material/TextField';\nimport MenuItem from '@mui/material/MenuItem';\nimport Stack from '@mui/material/Stack';\nimport Pagination from '@mui/material/Pagination';\nimport CircularProgress from '@mui/material/CircularProgress';\nimport Chip from '@mui/material/Chip';\nimport MainCard from 'components/MainCard';\nimport { useAuth } from 'contexts/AuthContext';\n\nexport default function DepositsPage() {\n  const { api, user } = useAuth();\n  const [deposits, setDeposits] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [page, setPage] = useState(1);\n  const [limit] = useState(20);\n  const [pagination, setPagination] = useState({ total: 0, total_pages: 1 });\n  const [merchantId, setMerchantId] = useState('');\n\n  useEffect(() => {\n    let cancelled = false;\n    async function load() {\n      try {\n        setLoading(true);\n        const params = { page, limit };\n        if (user?.is_admin && merchantId) params.merchant_id = merchantId;\n        const res = await api.get('/api/dashboard/deposits', { params });\n        if (cancelled) return;\n        setDeposits(res.data?.deposits || []);\n        const p = res.data?.pagination || {};\n        setPagination({ total: p.total || 0, total_pages: p.total_pages || 1 });\n      } catch (e) {\n        console.error(e);\n        if (!cancelled) setDeposits([]);\n      } finally {\n        if (!cancelled) setLoading(false);\n      }\n    }\n    load();\n    return () => { cancelled = true; };\n  }, [api, page, limit, merchantId, user?.is_admin]);\n\n  return (\n    <Grid container rowSpacing={4.5} columnSpacing={2.75}>\n      <Grid size={12}>\n        <Typography variant=\"h5\">Deposits</Typography>\n      </Grid>\n      {user?.is_admin && (\n        <Grid size={12}>\n          <MainCard content={false}>\n            <Box sx={{ p: 2 }}>\n              <TextField\n                size=\"small\"\n                label=\"Merchant ID\"\n                value={merchantId}\n                onChange={(e) => { setMerchantId(e.target.value); setPage(1); }}\n                sx={{ minWidth: 160 }}\n              />\n            </Box>\n          </MainCard>\n        </Grid>\n      )}\n      <Grid size={12}>\n        <MainCard title={`Deposits (${pagination.total} total)`} content={false}>\n          {loading ? (\n            <Box sx={{ p: 4, textAlign: 'center' }}>\n              <CircularProgress />\n            </Box>\n          ) : (\n            <>\n              <Table size=\"small\" sx={{ minWidth: 640 }}>\n                <TableHead>\n                  <TableRow>\n                    <TableCell>ID</TableCell>\n                    <TableCell>Deposit ID</TableCell>\n                    <TableCell>Merchant Ref</TableCell>\n                    {user?.is_admin && <TableCell>Merchant ID</TableCell>}\n                    <TableCell>Status</TableCell>\n                    <TableCell align=\"right\">Expected (USDT)</TableCell>\n                    <TableCell align=\"right\">Received (USDT)</TableCell>\n                    <TableCell>Created</TableCell>\n                  </TableRow>\n                </TableHead>\n                <TableBody>\n                  {deposits.map((d) => (\n                    <TableRow key={d.id} hover>\n                      <TableCell>{d.id}</TableCell>\n                      <TableCell>{d.deposit_id}</TableCell>\n                      <TableCell>{d.merchant_deposit_id || '—'}</TableCell>\n                      {user?.is_admin && <TableCell>{d.merchant_id}</TableCell>}\n                      <TableCell>\n                        <Chip label={d.status || 'pending'} size=\"small\" color={d.status === 'completed' ? 'success' : d.status === 'failed' ? 'error' : 'default'} variant=\"outlined\" />\n                      </TableCell>\n                      <TableCell align=\"right\">{Number(d.expected_amount || 0).toLocaleString()}</TableCell>\n                      <TableCell align=\"right\">{Number(d.received_amount || 0).toLocaleString()}</TableCell>\n                      <TableCell>{d.created_at ? format(new Date(d.created_at), 'MMM d, yyyy HH:mm') : '—'}</TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n              {deposits.length === 0 && !loading && (\n                <Box sx={{ p: 4, textAlign: 'center' }}>\n                  <Typography color=\"text.secondary\">No deposits found.</Typography>\n                </Box>\n              )}\n              {pagination.total_pages > 1 && (\n                <Stack direction=\"row\" justifyContent=\"center\" sx={{ py: 2 }}>\n                  <Pagination count={pagination.total_pages} page={page} onChange={(_, p) => setPage(p)} color=\"primary\" />\n                </Stack>\n              )}\n            </>\n          )}\n        </MainCard>\n      </Grid>\n    </Grid>\n  );\n}\n"],"names":["DepositsPage","api","user","useAuth","deposits","setDeposits","useState","loading","setLoading","page","setPage","limit","pagination","setPagination","merchantId","setMerchantId","useEffect","cancelled","load","params","res","p","e","Grid","jsx","Typography","MainCard","Box","TextField","CircularProgress","jsxs","Fragment","Table","TableHead","TableRow","TableCell","TableBody","d","Chip","format","Stack","Pagination","_"],"mappings":"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"}