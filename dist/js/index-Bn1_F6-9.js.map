{"version":3,"file":"index-Bn1_F6-9.js","sources":["../../src/pages/analytics/index.jsx"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport Grid from '@mui/material/Grid';\nimport Typography from '@mui/material/Typography';\nimport Box from '@mui/material/Box';\nimport CircularProgress from '@mui/material/CircularProgress';\nimport TextField from '@mui/material/TextField';\nimport MenuItem from '@mui/material/MenuItem';\nimport Stack from '@mui/material/Stack';\nimport MainCard from 'components/MainCard';\nimport AnalyticEcommerce from 'components/cards/statistics/AnalyticEcommerce';\nimport { useAuth } from 'contexts/AuthContext';\nimport { useTheme } from '@mui/material/styles';\nimport { BarChart } from '@mui/x-charts/BarChart';\nimport { LineChart } from '@mui/x-charts/LineChart';\n\nfunction formatDate(d) {\n  return d.toISOString().slice(0, 10);\n}\n\nexport default function AnalyticsPage() {\n  const { api } = useAuth();\n  const theme = useTheme();\n  const [loading, setLoading] = useState(true);\n  const [byStatus, setByStatus] = useState({ completed: 0, failed: 0, pending: 0 });\n  const [overview, setOverview] = useState({ periods: [] });\n  const [fromDate, setFromDate] = useState(() => formatDate(new Date(Date.now() - 30 * 24 * 60 * 60 * 1000)));\n  const [toDate, setToDate] = useState(() => formatDate(new Date()));\n  const [groupBy, setGroupBy] = useState('day');\n\n  useEffect(() => {\n    let cancelled = false;\n    async function load() {\n      try {\n        setLoading(true);\n        const [statusRes, overviewRes] = await Promise.all([\n          api.get('/api/dashboard/analytics/by-status'),\n          api.get('/api/dashboard/analytics/overview', {\n            params: { from_date: fromDate, to_date: toDate, group_by: groupBy }\n          })\n        ]);\n        if (cancelled) return;\n        setByStatus(statusRes.data?.by_status || {});\n        setOverview(overviewRes.data?.analytics || { periods: [] });\n      } catch (e) {\n        console.error(e);\n      } finally {\n        if (!cancelled) setLoading(false);\n      }\n    }\n    load();\n    return () => { cancelled = true; };\n  }, [api, fromDate, toDate, groupBy]);\n\n  if (loading) {\n    return (\n      <Box sx={{ display: 'flex', justifyContent: 'center', alignItems: 'center', minHeight: '400px' }}>\n        <CircularProgress />\n      </Box>\n    );\n  }\n\n  const total = (byStatus.completed || 0) + (byStatus.failed || 0) + (byStatus.pending || 0);\n  const successRate = total > 0 ? ((byStatus.completed / total) * 100).toFixed(1) : 0;\n\n  const periods = overview.periods || [];\n  const labels = periods.map((p) => p.date);\n  const amounts = periods.map((p) => Number(p.total_amount || 0));\n  const counts = periods.map((p) => Number(p.transaction_count || 0));\n\n  return (\n    <Grid container rowSpacing={4.5} columnSpacing={2.75}>\n      <Grid size={12}>\n        <Typography variant=\"h5\">Analytics</Typography>\n      </Grid>\n\n      <Grid size={{ xs: 12, sm: 6, md: 4, lg: 3 }}>\n        <AnalyticEcommerce title=\"Total Transactions\" count={String(total)} extra={String(byStatus.pending)} />\n      </Grid>\n      <Grid size={{ xs: 12, sm: 6, md: 4, lg: 3 }}>\n        <AnalyticEcommerce title=\"Completed\" count={String(byStatus.completed || 0)} percentage={Number(successRate)} color=\"success\" extra={`${successRate}%`} />\n      </Grid>\n      <Grid size={{ xs: 12, sm: 6, md: 4, lg: 3 }}>\n        <AnalyticEcommerce title=\"Pending\" count={String(byStatus.pending || 0)} isLoss color=\"warning\" extra={String(byStatus.failed || 0)} />\n      </Grid>\n      <Grid size={{ xs: 12, sm: 6, md: 4, lg: 3 }}>\n        <AnalyticEcommerce title=\"Total Volume (USDT)\" count={`$${periods.reduce((s, p) => s + Number(p.total_amount || 0), 0).toLocaleString()}`} extra=\"Period\" />\n      </Grid>\n\n      <Grid size={12}>\n        <MainCard title=\"Filters\" content={false}>\n          <Stack direction=\"row\" spacing={2} sx={{ p: 2 }} flexWrap=\"wrap\">\n            <TextField size=\"small\" type=\"date\" label=\"From\" value={fromDate} onChange={(e) => setFromDate(e.target.value)} InputLabelProps={{ shrink: true }} />\n            <TextField size=\"small\" type=\"date\" label=\"To\" value={toDate} onChange={(e) => setToDate(e.target.value)} InputLabelProps={{ shrink: true }} />\n            <TextField select size=\"small\" label=\"Group by\" value={groupBy} onChange={(e) => setGroupBy(e.target.value)} sx={{ minWidth: 120 }}>\n              <MenuItem value=\"day\">Day</MenuItem>\n              <MenuItem value=\"week\">Week</MenuItem>\n              <MenuItem value=\"month\">Month</MenuItem>\n            </TextField>\n          </Stack>\n        </MainCard>\n      </Grid>\n\n      {labels.length > 0 && (\n        <>\n          <Grid size={12}>\n            <MainCard title=\"Volume over time (USDT)\" content={false}>\n              <Box sx={{ p: 2, height: 360 }}>\n                <BarChart\n                  xAxis={[{ scaleType: 'band', data: labels }]}\n                  series={[{ data: amounts, label: 'Amount' }]}\n                  height={320}\n                  colors={[theme.palette.primary.main]}\n                />\n              </Box>\n            </MainCard>\n          </Grid>\n          <Grid size={12}>\n            <MainCard title=\"Transaction count over time\" content={false}>\n              <Box sx={{ p: 2, height: 360 }}>\n                <LineChart\n                  xAxis={[{ scaleType: 'point', data: labels }]}\n                  series={[{ data: counts, label: 'Count' }]}\n                  height={320}\n                  colors={[theme.palette.info.main]}\n                />\n              </Box>\n            </MainCard>\n          </Grid>\n        </>\n      )}\n\n      {labels.length === 0 && (\n        <Grid size={12}>\n          <MainCard>\n            <Typography color=\"text.secondary\">No data for the selected period.</Typography>\n          </MainCard>\n        </Grid>\n      )}\n    </Grid>\n  );\n}\n"],"names":["formatDate","d","AnalyticsPage","api","useAuth","theme","useTheme","loading","setLoading","useState","byStatus","setByStatus","overview","setOverview","fromDate","setFromDate","toDate","setToDate","groupBy","setGroupBy","useEffect","cancelled","load","statusRes","overviewRes","e","jsx","Box","CircularProgress","total","successRate","periods","labels","p","amounts","counts","Grid","Typography","AnalyticEcommerce","s","MainCard","jsxs","Stack","TextField","MenuItem","Fragment","BarChart","LineChart"],"mappings":"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"}