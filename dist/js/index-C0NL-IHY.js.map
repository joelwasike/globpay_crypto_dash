{"version":3,"file":"index-C0NL-IHY.js","sources":["../../src/pages/withdrawals/index.jsx"],"sourcesContent":["import { useState, useEffect } from 'react';\nimport { format } from 'date-fns';\nimport Box from '@mui/material/Box';\nimport Grid from '@mui/material/Grid';\nimport Typography from '@mui/material/Typography';\nimport Table from '@mui/material/Table';\nimport TableBody from '@mui/material/TableBody';\nimport TableCell from '@mui/material/TableCell';\nimport TableHead from '@mui/material/TableHead';\nimport TableRow from '@mui/material/TableRow';\nimport TextField from '@mui/material/TextField';\nimport Button from '@mui/material/Button';\nimport Stack from '@mui/material/Stack';\nimport Pagination from '@mui/material/Pagination';\nimport CircularProgress from '@mui/material/CircularProgress';\nimport Alert from '@mui/material/Alert';\nimport Chip from '@mui/material/Chip';\nimport MainCard from 'components/MainCard';\nimport { useAuth } from 'contexts/AuthContext';\n\nexport default function WithdrawalsPage() {\n  const { api, user } = useAuth();\n  const [withdrawals, setWithdrawals] = useState([]);\n  const [loading, setLoading] = useState(true);\n  const [page, setPage] = useState(1);\n  const [limit] = useState(20);\n  const [pagination, setPagination] = useState({ total: 0, total_pages: 1 });\n  const [merchantId, setMerchantId] = useState('');\n  const [withdrawing, setWithdrawing] = useState(false);\n  const [withdrawAddress, setWithdrawAddress] = useState('');\n  const [withdrawError, setWithdrawError] = useState('');\n  const [withdrawSuccess, setWithdrawSuccess] = useState('');\n\n  const load = () => {\n    setLoading(true);\n    const params = { page, limit };\n    if (user?.is_admin && merchantId) params.merchant_id = merchantId;\n    api\n      .get('/api/dashboard/withdrawals', { params })\n      .then((res) => {\n        setWithdrawals(res.data?.withdrawals || []);\n        const p = res.data?.pagination || {};\n        setPagination({ total: p.total || 0, total_pages: p.total_pages || 1 });\n      })\n      .catch(() => setWithdrawals([]))\n      .finally(() => setLoading(false));\n  };\n\n  useEffect(() => {\n    load();\n  }, [api, page, limit, merchantId, user?.is_admin]);\n\n  const handleWithdraw = async (e) => {\n    e.preventDefault();\n    if (!withdrawAddress.trim()) return;\n    setWithdrawError('');\n    setWithdrawSuccess('');\n    setWithdrawing(true);\n    try {\n      await api.post('/api/dashboard/withdraw', { destination_address: withdrawAddress.trim() });\n      setWithdrawSuccess('Withdrawal initiated successfully.');\n      setWithdrawAddress('');\n      load();\n    } catch (err) {\n      setWithdrawError(err.response?.data?.error || 'Withdrawal failed.');\n    } finally {\n      setWithdrawing(false);\n    }\n  };\n\n  return (\n    <Grid container rowSpacing={4.5} columnSpacing={2.75}>\n      <Grid size={12}>\n        <Typography variant=\"h5\">Withdrawals</Typography>\n      </Grid>\n\n      <Grid size={12}>\n        <MainCard title=\"Withdraw USDT\">\n          <Box component=\"form\" onSubmit={handleWithdraw} sx={{ maxWidth: 480 }}>\n            <Stack spacing={2}>\n              <TextField\n                fullWidth\n                label=\"Destination address (Solana)\"\n                value={withdrawAddress}\n                onChange={(e) => setWithdrawAddress(e.target.value)}\n                placeholder=\"Enter Solana address\"\n                required\n                disabled={withdrawing}\n              />\n              {withdrawError && <Alert severity=\"error\">{withdrawError}</Alert>}\n              {withdrawSuccess && <Alert severity=\"success\">{withdrawSuccess}</Alert>}\n              <Button type=\"submit\" variant=\"contained\" disabled={withdrawing}>\n                {withdrawing ? 'Withdrawing...' : 'Withdraw'}\n              </Button>\n            </Stack>\n          </Box>\n        </MainCard>\n      </Grid>\n\n      {user?.is_admin && (\n        <Grid size={12}>\n          <MainCard content={false}>\n            <Box sx={{ p: 2 }}>\n              <TextField\n                size=\"small\"\n                label=\"Merchant ID\"\n                value={merchantId}\n                onChange={(e) => { setMerchantId(e.target.value); setPage(1); }}\n                sx={{ minWidth: 160 }}\n              />\n            </Box>\n          </MainCard>\n        </Grid>\n      )}\n\n      <Grid size={12}>\n        <MainCard title={`Withdrawal history (${pagination.total} total)`} content={false}>\n          {loading ? (\n            <Box sx={{ p: 4, textAlign: 'center' }}>\n              <CircularProgress />\n            </Box>\n          ) : (\n            <>\n              <Table size=\"small\" sx={{ minWidth: 640 }}>\n                <TableHead>\n                  <TableRow>\n                    <TableCell>ID</TableCell>\n                    {user?.is_admin && <TableCell>Merchant ID</TableCell>}\n                    <TableCell>Destination</TableCell>\n                    <TableCell align=\"right\">Total Withdrawn (USDT)</TableCell>\n                    <TableCell>Success / Failed</TableCell>\n                    <TableCell>Status</TableCell>\n                    <TableCell>Created</TableCell>\n                  </TableRow>\n                </TableHead>\n                <TableBody>\n                  {withdrawals.map((w) => (\n                    <TableRow key={w.id} hover>\n                      <TableCell>{w.id}</TableCell>\n                      {user?.is_admin && <TableCell>{w.merchant_id}</TableCell>}\n                      <TableCell sx={{ maxWidth: 200, overflow: 'hidden', textOverflow: 'ellipsis' }}>{w.destination_address}</TableCell>\n                      <TableCell align=\"right\">{Number(w.total_withdrawn || 0).toLocaleString()}</TableCell>\n                      <TableCell>{w.successful_withdrawals} / {w.failed_withdrawals}</TableCell>\n                      <TableCell>\n                        <Chip label={w.status || 'pending'} size=\"small\" color={w.status === 'completed' ? 'success' : 'default'} variant=\"outlined\" />\n                      </TableCell>\n                      <TableCell>{w.created_at ? format(new Date(w.created_at), 'MMM d, yyyy HH:mm') : 'â€”'}</TableCell>\n                    </TableRow>\n                  ))}\n                </TableBody>\n              </Table>\n              {withdrawals.length === 0 && !loading && (\n                <Box sx={{ p: 4, textAlign: 'center' }}>\n                  <Typography color=\"text.secondary\">No withdrawals yet.</Typography>\n                </Box>\n              )}\n              {pagination.total_pages > 1 && (\n                <Stack direction=\"row\" justifyContent=\"center\" sx={{ py: 2 }}>\n                  <Pagination count={pagination.total_pages} page={page} onChange={(_, p) => setPage(p)} color=\"primary\" />\n                </Stack>\n              )}\n            </>\n          )}\n        </MainCard>\n      </Grid>\n    </Grid>\n  );\n}\n"],"names":["WithdrawalsPage","api","user","useAuth","withdrawals","setWithdrawals","useState","loading","setLoading","page","setPage","limit","pagination","setPagination","merchantId","setMerchantId","withdrawing","setWithdrawing","withdrawAddress","setWithdrawAddress","withdrawError","setWithdrawError","withdrawSuccess","setWithdrawSuccess","load","params","res","p","useEffect","handleWithdraw","e","err","Grid","jsx","Typography","MainCard","Box","jsxs","Stack","TextField","Alert","Button","CircularProgress","Fragment","Table","TableHead","TableRow","TableCell","TableBody","w","Chip","format","Pagination","_"],"mappings":"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"}